<?xml version="1.0" encoding="utf-8"?>
<xs:schema id="fpos5DataSet" targetNamespace="http://tempuri.org/fpos5DataSet.xsd" xmlns:mstns="http://tempuri.org/fpos5DataSet.xsd" xmlns="http://tempuri.org/fpos5DataSet.xsd" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:msdata="urn:schemas-microsoft-com:xml-msdata" xmlns:msprop="urn:schemas-microsoft-com:xml-msprop" attributeFormDefault="qualified" elementFormDefault="qualified">
  <xs:annotation>
    <xs:appinfo source="urn:schemas-microsoft-com:xml-msdatasource">
      <DataSource DefaultConnectionIndex="0" FunctionsComponentName="QueriesTableAdapter" Modifier="AutoLayout, AnsiClass, Class, Public" SchemaSerializationMode="IncludeSchema" xmlns="urn:schemas-microsoft-com:xml-msdatasource">
        <Connections>
          <Connection AppSettingsObjectName="Settings" AppSettingsPropertyName="fpos5ConnectionString" ConnectionStringObject="" IsAppSettingsProperty="true" Modifier="Assembly" Name="fpos5ConnectionString (Settings)" ParameterPrefix="@" PropertyReference="ApplicationSettings.FPOSReports.Properties.Settings.GlobalReference.Default.fpos5ConnectionString" Provider="System.Data.SqlClient" />
        </Connections>
        <Tables>
          <TableAdapter BaseClass="System.ComponentModel.Component" DataAccessorModifier="AutoLayout, AnsiClass, Class, Public" DataAccessorName="ItemSoldTableAdapter" GeneratorDataComponentClassName="ItemSoldTableAdapter" Name="ItemSoldTable" UserDataComponentName="ItemSoldTableAdapter">
            <MainSource>
              <DbSource ConnectionRef="fpos5ConnectionString (Settings)" DbObjectName="" DbObjectType="Unknown" FillMethodModifier="Public" FillMethodName="Fill" GenerateMethods="Both" GenerateShortCommands="false" GeneratorGetMethodName="GetData" GeneratorSourceName="Fill" GetMethodModifier="Public" GetMethodName="GetData" QueryType="Rowset" ScalarCallRetval="System.Object, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" UseOptimisticConcurrency="false" UserGetMethodName="GetData" UserSourceName="Fill">
                <SelectCommand>
                  <DbCommand CommandType="Text" ModifiedByUser="true">
                    <CommandText>CREATE TABLE #tmp
(
	Time Int,
	GrossSales Decimal,
	Discount Decimal,
	NetSalesNoTax Decimal,
	Taxes Decimal,
	NetSalesWithTax Decimal,
	TimeLabel NVARCHAR(MAX) COLLATE DATABASE_DEFAULT
)

INSERT INTO #tmp (Time,GrossSales,Discount,NetSalesNoTax,Taxes,NetSalesWithTax,TimeLabel)
VALUES
    (0,0,0,0,0,0,'12am'),
	(1,0,0,0,0,0,'1am'),
	(2,0,0,0,0,0,'2am'),
	(3,0,0,0,0,0,'3am'),
	(4,0,0,0,0,0,'4am'),
	(5,0,0,0,0,0,'5am'),
	(6,0,0,0,0,0,'6am'),
	(7,0,0,0,0,0,'7am'),
	(8,0,0,0,0,0,'8am'),
	(9,0,0,0,0,0,'9am'),
	(10,0,0,0,0,0,'10am'),
	(11,0,0,0,0,0,'11am'),
	(12,0,0,0,0,0,'12pm'),
	(13,0,0,0,0,0,'1pm'),
	(14,0,0,0,0,0,'2pm'),
	(15,0,0,0,0,0,'3pm'),
	(16,0,0,0,0,0,'4pm'),
	(17,0,0,0,0,0,'5pm'),
	(18,0,0,0,0,0,'6pm'),
	(19,0,0,0,0,0,'7pm'),
	(20,0,0,0,0,0,'8pm'),
	(21,0,0,0,0,0,'9pm'),
	(22,0,0,0,0,0,'10pm'),
	(23,0,0,0,0,0,'11pm');

select t.Time,t.TimeLabel,
coalesce(r.GrossSales,0) as GrossSales, 
coalesce(r.Discount,0) as Discount,
coalesce(r.NetSalesNoTax,0) as NetSalesNoTax,
coalesce(r.NetSalesWithTax,0) as NetSalesWithTax,
coalesce(r.Taxes,0) as Taxes  
from (
	select DATEPART(hour, SoldDate) as Time,CONVERT(date, SoldDate) as Date,
	SUM(CAST(GrossPrice as decimal)/100) as GrossSales,
	SUM((CAST(GrossPrice as decimal) - CAST(ActualPrice as decimal))/100) as Discount,
	SUM(CAST(ActualPrice as decimal) /100) as NetSalesNoTax,
	SUM(CAST(TotalTax as decimal)/100) as Taxes,
	Sum((CAST(ActualPrice as decimal) + CAST(TotalTax as decimal))/100) as NetSalesWithTax,
	'' as TimeLabel
	from SaleItem as si LEFT JOIN
	Sale as s on s.SaleID = si.SaleID
	where s.IsCancelled = 0 AND
		s.IsSuspend = 0 AND
		s.IsTrainMode = 0 AND
		si.VoidDate IS NULL AND
		si.SoldDate IS NOT NULL AND
		CONVERT(date,si.SoldDate) &gt;= CONVERT(date,@StartDate) AND 
                                CONVERT(date,si.SoldDate) &lt;= CONVERT(date,@EndDate)
	group by DATEPART(hour, SoldDate),CONVERT(date, SoldDate)
) as r 
RIGHT JOIN #tmp as t on t.Time = r.Time</CommandText>
                    <Parameters>
                      <Parameter AllowDbNull="false" AutogeneratedName="" ColumnName="@StartDate" DataSourceName="" DbType="AnsiString" Direction="Input" ParameterName="@StartDate" Precision="0" Scale="0" Size="0" SourceColumnNullMapping="false" SourceVersion="Current" />
                      <Parameter AllowDbNull="false" AutogeneratedName="" ColumnName="@EndDate" DataSourceName="" DbType="AnsiString" Direction="Input" ParameterName="@EndDate" Precision="0" Scale="0" Size="0" SourceColumnNullMapping="false" SourceVersion="Current" />
                    </Parameters>
                  </DbCommand>
                </SelectCommand>
              </DbSource>
            </MainSource>
            <Mappings>
              <Mapping SourceColumn="Time" DataSetColumn="Time" />
              <Mapping SourceColumn="TimeLabel" DataSetColumn="TimeLabel" />
              <Mapping SourceColumn="GrossSales" DataSetColumn="GrossSales" />
              <Mapping SourceColumn="Discount" DataSetColumn="Discount" />
              <Mapping SourceColumn="NetSalesNoTax" DataSetColumn="NetSalesNoTax" />
              <Mapping SourceColumn="Taxes" DataSetColumn="Taxes" />
              <Mapping SourceColumn="NetSalesWithTax" DataSetColumn="NetSalesWithTax" />
            </Mappings>
            <Sources />
          </TableAdapter>
        </Tables>
        <Sources />
      </DataSource>
    </xs:appinfo>
  </xs:annotation>
  <xs:element name="fpos5DataSet" msdata:IsDataSet="true" msdata:UseCurrentLocale="true" msprop:EnableTableAdapterManager="True" msprop:Generator_DataSetName="fpos5DataSet" msprop:Generator_UserDSName="fpos5DataSet">
    <xs:complexType>
      <xs:choice minOccurs="0" maxOccurs="unbounded">
        <xs:element name="ItemSoldTable" msprop:Generator_TableClassName="ItemSoldTableDataTable" msprop:Generator_TableVarName="tableItemSoldTable" msprop:Generator_RowChangedName="ItemSoldTableRowChanged" msprop:Generator_TablePropName="ItemSoldTable" msprop:Generator_RowDeletingName="ItemSoldTableRowDeleting" msprop:Generator_RowChangingName="ItemSoldTableRowChanging" msprop:Generator_RowEvHandlerName="ItemSoldTableRowChangeEventHandler" msprop:Generator_RowDeletedName="ItemSoldTableRowDeleted" msprop:Generator_RowClassName="ItemSoldTableRow" msprop:Generator_UserTableName="ItemSoldTable" msprop:Generator_RowEvArgName="ItemSoldTableRowChangeEvent">
          <xs:complexType>
            <xs:sequence>
              <xs:element name="Time" msdata:ReadOnly="true" msprop:Generator_ColumnVarNameInTable="columnTime" msprop:Generator_ColumnPropNameInRow="Time" msprop:Generator_ColumnPropNameInTable="TimeColumn" msprop:Generator_UserColumnName="Time" type="xs:int" minOccurs="0" />
              <xs:element name="TimeLabel" msdata:ReadOnly="true" msprop:Generator_ColumnVarNameInTable="columnTimeLabel" msprop:Generator_ColumnPropNameInRow="TimeLabel" msprop:Generator_ColumnPropNameInTable="TimeLabelColumn" msprop:Generator_UserColumnName="TimeLabel" minOccurs="0">
                <xs:simpleType>
                  <xs:restriction base="xs:string">
                    <xs:maxLength value="11" />
                  </xs:restriction>
                </xs:simpleType>
              </xs:element>
              <xs:element name="GrossSales" msdata:ReadOnly="true" msprop:Generator_ColumnVarNameInTable="columnGrossSales" msprop:Generator_ColumnPropNameInRow="GrossSales" msprop:Generator_ColumnPropNameInTable="GrossSalesColumn" msprop:Generator_UserColumnName="GrossSales" type="xs:decimal" minOccurs="0" />
              <xs:element name="Discount" msdata:ReadOnly="true" msprop:Generator_ColumnVarNameInTable="columnDiscount" msprop:Generator_ColumnPropNameInRow="Discount" msprop:Generator_ColumnPropNameInTable="DiscountColumn" msprop:Generator_UserColumnName="Discount" type="xs:decimal" minOccurs="0" />
              <xs:element name="NetSalesNoTax" msdata:ReadOnly="true" msprop:Generator_ColumnVarNameInTable="columnNetSalesNoTax" msprop:Generator_ColumnPropNameInRow="NetSalesNoTax" msprop:Generator_ColumnPropNameInTable="NetSalesNoTaxColumn" msprop:Generator_UserColumnName="NetSalesNoTax" type="xs:decimal" minOccurs="0" />
              <xs:element name="Taxes" msdata:ReadOnly="true" msprop:Generator_ColumnVarNameInTable="columnTaxes" msprop:Generator_ColumnPropNameInRow="Taxes" msprop:Generator_ColumnPropNameInTable="TaxesColumn" msprop:Generator_UserColumnName="Taxes" type="xs:decimal" minOccurs="0" />
              <xs:element name="NetSalesWithTax" msdata:ReadOnly="true" msprop:Generator_ColumnVarNameInTable="columnNetSalesWithTax" msprop:Generator_ColumnPropNameInRow="NetSalesWithTax" msprop:Generator_ColumnPropNameInTable="NetSalesWithTaxColumn" msprop:Generator_UserColumnName="NetSalesWithTax" type="xs:decimal" minOccurs="0" />
            </xs:sequence>
          </xs:complexType>
        </xs:element>
      </xs:choice>
    </xs:complexType>
  </xs:element>
</xs:schema>